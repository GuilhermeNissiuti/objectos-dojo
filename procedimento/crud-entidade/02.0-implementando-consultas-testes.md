---
layout: post-alpha
title: "Implementando Consultas: Testes"
author: "Tiago Aguiar"
user: "taguiar"
date: "2012-03-14"
published: true
partof: procedimento-crud-entidade
num: 5
---

## <a id="TOPO"> </a> Introdução
A partir do momento em que temos informações armazenadas (seja em uma agenda, CD ou Banco de Dados),
podemos consultá-las. Essas consultas podem ser feitas manualmente (buscando em uma agenda) ou por
um sistema/programa que traz as infromações para a tela de seu computador.

Nota: A interface gráfica das consultas não fazem parte do escopo deste artigo, apenas os testes.

## Antes de iniciar 
Este item exige conhecimentos sobre:

- [TDD](http://dojo.objectos.com.br/caixa/processo-00-TDD.html)
- [Mini-arquivo.xml](http://dojo.objectos.com.br/procedimento/crud-entidade/faq-03-mini-arquivos-especificos.html)
- [Package - com.google.common.base](http://google-collections.googlecode.com/svn/trunk/javadoc/com/google/common/base/package-summary.html)
- Linguagem SQL

## Especificação
Imagine o seguinte cenário: Suponhamos que uma biblioteca de uma universidade já possui um banco de
dados chamado `BIBLIOTECA` com centenas de livros armazenados. Porém, a biblioteca precisa que seus 
alunos e professores consigam consultar estes livros através dos computadores para obter sua localização 
exata nas prateleiras desta biblioteca.

Temos a tabela `LIVRO` com as seguintes colunas no banco de dados `BIBLIOTECA`.

- Id
- Título
- Localização
- Autor Principal
- Autor Secundário
- Publicação
- Descrição Física
- Título Original
- ISBN
- Assuntos

Nota: Detalharemos estes atributos mais adiante (tipos de dados e restrições). Preocupe-se apenas
com a especificação neste momento.

### Quais campos devemos exibir?   
A princípio, o ideal seria mostrar todos os campos, mas as vezes, nem sempre é assim. Neste exemplo,
temos um campo __Título Original__, este campo não será necessário se estivermos consultando o livros
apenas no idioma português. Em contrapartida, há pessoas que querem saber o __Título Original__ do livro
para comprá-lo em outro idioma.<br>
 
Na dúvida, sempre pergunte ao seu líder de projeto!

Voltando ao nosso exemplo, precisamos listar todos os campos exceto o id (o usuário não precisa saber
esta informação, ela faz parte da biblioteca e não do livro)

`TITULO`: É fundamental saber o título do livro;<br>
`LOCALIZACAO`: O corredor e a prateleira;<br>
`AUTOR_PRINCIPAL`: Muitos usuários consultam livros através de autores;<br>
`AUTOR_SECUNDARIO`: Conhecer livros que este autor secundário tenha publicado como autor principal;<br>
`PUBLICACAO`: Sabendo a data em que foi publicado, podemos escolher um outro livro mais recente;<br>
`DESCRICAO_FISICA`: Aqui podemos escolher o livro com menor número de páginas (um guia de bolso);<br>
`TITULO_ORIGINAL`: Conforme comentado, para compras do mesmo livro em outro idioma;<br>
`ISBN`: Não é possível visualizar o código de barras e ISBN do livro na hora do empréstimo (livro velho)?
Digite o ISBN armazenado no banco de dados no sistema de empréstimo para resolver o problema;<br>
`ASSUNTOS`: Alguns usuários realizam consultas através de assuntos.<br>
 
Note que nosso cliente apenas deseja que alunos e professores consulte os livros no intuito de localizá-los
nas prateleiras. Mas, isto não nos impede de pensar em futuras melhorias como é o caso da utilização do
 __ISBN__ para o empréstimo conforme comentários acima.


## Implementação
Considerando que temos:

1. A Classe-Entidade. Veja como criá-la [aqui]({{ site.baseurl }}/procedimento/crud-entidade/00.0-criando-entidades-java.html)<br>
2. Todos os dados armazenados na tabela LIVRO. Veja como criá-la [aqui]({{ site.baseurl }}/procedimento/crud-entidade/00.1-criando-testando-script-flyway.html)<br>
3. O mini-arquivo.xml com estes dados. Veja como criá-lo [aqui]({{ site.baseurl }}/procedimento/crud-entidade/faq-03-mini-arquivos-especificos.html)<br>

Nota: Validaremos mais adiante se os dados no mini-arquivo são suficientes para os testes!

Siga o checklist abaixo:
<table class="table table-bordered">
 <tr>
   <td class="tac col2em">
    <a id="topo_0_0"><input type="checkbox" /></a>
   </td>
   <td>
	<a href="#0_0">Preparar o teste e suas dependências</a>  
   </td>
 </tr>
  <tr>
   <td class="tac col2em">
    <a id="topo_0_1"><input type="checkbox" /></a>
   </td>
   <td>
    <a href="#0_1">Preparar o método de consulta com ordenação</a>
   </td>
 </tr>
   <tr>
   <td class="tac col2em">
    <a id="topo_0_1"><input type="checkbox" /></a>
   </td>
   <td>
    <a href="#0_2">Preparar o método de consulta com filtro</a>
   </td>
 </tr>
</table>

### <a id="0_0"> </a>Preparar o teste e suas dependências
Crie a classe `TesteDeConsultaDeLivro` no pacote `seu-projeto.ui.api` do diretório `src/test/java/`.<br>
Exemplo: `br.com.objectos.dojo.biblioteca.ui.api`.

	public class TesteDeConsultaDeLivro {
	}
	
Defina a classe como sendo de __Teste__ e adicione o __Módulo de Teste__ (através das anotações).

	@Test
	@Guice(modules = ModuloDeTesteObjectosDojo.class)
	public class TesteDeConsultaDeLivro {
	}
	
Declare uma variável de referência para `ConsultaDeLivro`. Esta realizará nossas consultas.

	@Test
	@Guice(modules = ModuloDeTesteObjectosDojo.class)
	public class TesteDeConsultaDeLivro {
	
	  @Inject
	  private ConsultaDeLivro consulta;
	  
	}
 
Importante: Cada projeto utiliza diferentes módulos de teste, atente-se a isto!

### <a id="0_1"> </a>Preparar o método de consulta com ordenação

### <a id="0_2"> </a>Preparar o método de consulta com filtro

Siga para o próximo passo! <a href="{{ site.baseurl }}/procedimento/crud-entidade/02.1-implementando-consultas-consultas.html" class="btn btn-success">Continuar!</a><br>
Leia mais uma vez! <a href="#TOPO" class="btn btn-warning">Revisar!</a>