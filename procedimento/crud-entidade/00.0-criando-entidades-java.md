---
layout: post
title: Criando Entidades e Scripts Flyway
author: "Tiago Aguiar"
user: "taguiar"
date: "2012-03-14"
published: true
partof: procedimento-crud-entidade
num: 0
---

## Introdução

No mundo da TI, tudo se movimenta em torno de Informação. Essas informações devem ser bem
guardas. Logo, nos utilizemos do Banco de Dados.

Você já deve ter lido sobre [TDD](http://dojo.objectos.com.br/caixa/processo-00-TDD.html) correto? E para realizarmos qualquer tipo de teste precisamos de DADOS. Mostraremos como, onde e porque criar estes dados. 

## Antes de iniciar 
Este item exige conhecimentos sobre:
 - [Interfaces](http://en.wikipedia.org/wiki/Interface_%28Java%29)
 - [Annotations](http://docs.oracle.com/javase/1.5.0/docs/guide/language/annotations.html)


## Criando Entidades no Java
Em Java as Entidades representam um conceito de "modelo". Se você tem um sistema de e-commerce, 
por exemplo, você pode ter entidades como Cliente, NotaFiscal, Pedido, CarrinhoDeCompras, etc. 
As entidades são mapeadas para o banco de dados (modelo relacional).

Contudo, todas as entidades deverão ter atributos que, de fato, resolva o problema do cliente.
Em outras palavras, entender a __Especificação__.

Siga o checklist abaixo:
<table class="table table-bordered">
 <tr>
   <td class="tac col2em">
    <a id="topo_0_0"><input type="checkbox" /></a>
   </td>
   <td>
    Quais os campos nossa entidade deve ter?
   </td>
   <td>
    <a href="#0_0">help!</a>
   </td>
 </tr>
  <tr>
   <td class="tac col2em">
    <a id="topo_0_0"><input type="checkbox" /></a>
   </td>
   <td>
    Como criar uma Entidade no Java?
   </td>
   <td>
    <a href="#0_1">help!</a>
   </td>
 </tr>
  <tr>
   <td class="tac col2em">
    <a id="topo_0_0"><input type="checkbox" /></a>
   </td>
   <td>
    Todos os campos devem ser NULOS?
   </td>
   <td>
    <a href="#0_2">help!</a>
   </td>
 </tr>
</table>

### <a id="0_0"> </a>Quais os campos nossa entidade deve ter?

Suponhamos que nosso cliente tenha especificado: "O sistema que usaremos precisará cadastrar um
novo funcionário!"

Assim começamos a pensar nos campos que este funcionário poderia ter.

Precisaremos dos campos seguintes?
- Nome
- Matricula
- Data de nascimento
- Data de admissão
- Data de demissão
- Carteira de motorista

A resposta do nosso cliente é: "Os 5 primeiros precisaremos mas o último (carteira de motorista) não
é necessário pois nossos funcionários não realizarão trabalhos de campo. Em contrapartida, precisamos
ter 'guardado' a informação do regime de contratação (CLT, Estágio)".


Agora podemos criar a entidade __Funcionario__.

### <a id="0_1"> </a>Como criar uma Entidade no Java? 


- Crie uma Interface chamada Funcionario no diretório __/src/main/java/__ do seu projeto.

		public interface Funcionario {
			
			interface Construtor extends br.com.objectos.comuns.base.Construtor<Funcionario> {
			
			    String getNome();
				    
			    String getMatricula();
				
			    LocalDate getDataDeNascimento();
				
			    DateTime getDataDeAdmissao();
				    
			    DateTime getDataDeDemissao();
				    
			    Contrato getRegimeDeContratacao();
				
			}
			
			int getId();
				
			String getNome();
				    
			String getMatricula();
				
			LocalDate getDataDeNascimento();
				
			DateTime getDataDeAdmissao();
				    
			DateTime getDataDeDemissao();
				    
			Contrato getRegimeDeContratacao();
				
		}
		
O que fizemos aqui foi definir os campos da entidade Funcionario e um Construtor que 
servirá para instanciar objetos FALSOS (veremos isto mais adiante).

- Crie uma classe __FuncionarioJdbc__ que implemente a interface já definida.


		public class FuncionarioJdbc implements Funcionario {
		
		  private int id;
		
		  @NotNull	 			
		  private final String nome;
		
		  @NotNull			
		  private final String matricula;
		
		  @NotNull
		  private final LocalDate dataDeNascimento;
		  
		  @NotNull
		  private final DateTime dataDeAdmissao;
		  
		  private final DateTime dataDeDemissao;
		  
		  @NotNull
		  private final Contrato regimeDeContratacao;
		
		  public FuncionarioJdbc(Construtor construtor) {
		    nome = construtor.getNome();
		    matricula = construtor.getMatricula();
		    dataDeNascimento = construtor.getDataDeNascimento();
		    dataDeAdmissao = construtor.getDataDeAdmissao();
		    dataDeDemissao = construtor.getDataDeDemissao();
		    regimeDeContratacao = construtor.getRegimeDeContratacao();
		  }
		
		  @Override
		  public int getId() {
		    return id;
		  }
		
		  void setId(int id) {
		    this.id = id;
		  }
		
		  @Override
		  public String getNome() {
		    return nome;
		  }
		
		  @Override
		  public String getMatricula() {
		    return matricula;
		  }
		
		  @Override
		  public LocalDate getDataDeNascimento() {
		    return dataDeNascimento;
		  }
		  
		  @Override
		  public DateTime getDataDeAdmissao() {
		    return dataDeAdmissao;
		  }  
		
		  @Override
		  public DateTime getDataDeDemissao() {
		    return dataDeDemissao;
		  }  
		
		  @Override
		  public Contrato getRegimeDeContratacao() {
		    return regimeDeContratacao;
		  }
		
		}

Nota: TODAS as entidades DEVEM ter um método getter e um setter para o ID.

### <a id="0_2"> </a>Todos os campos devem ser NULOS?

Não temos uma resposta correta para esta pergunta, isto pode mudar de entidade para entidade.
Em nosso exemplo, definimos os campos como __not null__, exceto o campo da data de demissão, pois
quando um novo funcionário é cadastrado não precisamos inserir uma data de demissão para ele.

- Por fim, crie a __enum Contrato__ (regime de contratação).

		public enum Contrato {
		
		  CLT,
		  
		  ESTAGIO
		
		}

Siga para o próximo passo. Os Scripts Flyway! <a href="{{ site.baseurl }}/procedimento/crud-entidade/00.1-criando-testando-script-flyway.html" class="btn btn-success">Continuar!</a>